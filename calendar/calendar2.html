<!DOCTYPE html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Khaimook's Calendar</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box;}
    body{
      font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;
      background:linear-gradient(135deg,#fddeea 10%,#c683ed 100%);
      min-height:100vh;padding:20px;position:relative;
    }
    .calendar-banner{
      position:fixed;top:0;left:0;width:100%;
      background:rgba(215,239,244,0.95);
      padding:10px;text-align:center;font-weight:bold;
      z-index:1000;backdrop-filter:blur(5px);
    }
    .main-container{margin-top:60px;max-width:1400px;margin:auto;}
    .project-header{
      background:white;padding:30px;border-radius:15px;
      margin-bottom:20px;box-shadow:0 10px 30px rgba(0,0,0,0.1);text-align:center;
    }
    .project-title{color:#333;font-size:2.5em;margin-bottom:10px;}
    .project-subtitle{color:#666;font-size:1.2em;margin-bottom:20px;}
    .content-wrapper{
      display:grid;grid-template-columns:1fr 350px;gap:20px;margin-bottom:20px;
    }
    .calendar-body{
      background:white;border-radius:15px;box-shadow:0 20px 40px rgba(0,0,0,0.1);overflow:hidden;
    }
    .calendar-header{
      background:linear-gradient(45deg,#bde0fe,#ffafcc);color:white;padding:30px;text-align:center;
    }
    .calendar-title{font-size:2em;margin-bottom:10px;font-weight:bold;color:#2e6480;}
    .calendar-nav{display:flex;justify-content:space-between;align-items:center;margin-top:20px;}
    .nav-btn{
      background:rgba(255,255,255,0.5);border:none;color:#2e6480;
      padding:10px 20px;border-radius:25px;cursor:pointer;font-size:16px;font-weight:bold;
      transition:all 0.3s ease;
    }
    .nav-btn:hover{background:rgba(255,255,255,0.8);transform:translateY(-2px);}
    .current-month{font-size:1.5em;font-weight:bold;color:#2e6480;}
    .calendar-grid{
      display:grid;grid-template-columns:repeat(7,1fr);gap:1px;
      background:#f0f0f0;margin:20px;border-radius:10px;overflow:hidden;
    }
    .day-header{background:#bde0fe;color:#2e6480;padding:15px 5px;text-align:center;font-weight:600;}
    .day-cell{
      background:white;min-height:100px;padding:10px;cursor:pointer;
      transition:all 0.2s ease;position:relative;border:2px solid transparent;
    }
    .day-cell:hover{background:#f8f9ff;border-color:#bde0fe;}
    .day-cell.other-month{background:#f9f9f9;color:#ccc;}
    .day-cell.today{
      background:linear-gradient(45deg,#bde0fe,#ffafcc);color:#2e6480;font-weight:bold;
    }
    .day-number{font-weight:600;font-size:16px;margin-bottom:5px;}
    .event{
      background:#ff6b6b;color:white;padding:2px 6px;border-radius:12px;
      font-size:11px;margin:2px 0;cursor:pointer;transition:all 0.2s ease;
    }
    .event:hover{background:#ff5252;transform:scale(1.05);}
    .add-event-btn{
      position:fixed;bottom:30px;right:30px;background:linear-gradient(45deg,#6bfff0,#6de0f5);
      color:white;border:none;width:60px;height:60px;border-radius:50%;
      font-size:24px;cursor:pointer;box-shadow:0 5px 15px rgba(133,194,215,0.4);
      transition:all 0.3s ease;z-index:999;
    }
    .add-event-btn:hover{transform:scale(1.1) rotate(90deg);}
    .modal{
      display:none;position:fixed;top:0;left:0;width:100%;height:100%;
      background:rgba(0,0,0,0.7);backdrop-filter:blur(5px);z-index:1000;
      align-items:center;justify-content:center;
    }
    .modal-content{
      background:white;padding:30px;border-radius:15px;box-shadow:0 20px 40px rgba(0,0,0,0.3);
      min-width:400px;
    }
    .modal h3{margin-bottom:20px;color:#333;font-size:1.5em;}
    .modal input,.modal textarea{
      width:100%;padding:12px;margin:10px 0;border:2px solid #e0e0e0;
      border-radius:8px;font-size:16px;transition:border-color 0.3s ease;
    }
    .modal input:focus,.modal textarea:focus{border-color:#bde0fe;outline:none;}
    .modal-buttons{display:flex;gap:10px;margin-top:20px;}
    .btn{padding:12px 24px;border:none;border-radius:8px;cursor:pointer;font-size:16px;transition:all 0.3s ease;flex:1;}
    .btn-primary{background:linear-gradient(45deg,#bde0fe,#ffafcc);color:#2e6480;font-weight:bold;}
    .btn-secondary{background:#e0e0e0;color:#333;}
    .btn-danger{background:#ff6b6b;color:white;}
    .stats{padding:20px;background:#f8f9ff;margin:20px;border-radius:10px;text-align:center;}
    .events-sidebar{
      background:white;border-radius:15px;box-shadow:0 20px 40px rgba(0,0,0,0.1);
      padding:25px;max-height:850px;overflow-y:auto;
    }
    .event-item{
      background:linear-gradient(135deg,#f8f9ff 0%,#fff5f8 100%);
      padding:15px;border-radius:10px;margin-bottom:15px;
      border-left:4px solid #ff6b6b;transition:all 0.3s ease;cursor:pointer;
    }
    .event-item:hover{transform:translateX(5px);}
    .event-item-title{font-weight:bold;color:#333;font-size:16px;margin-bottom:5px;}
    .event-item-date{color:#666;font-size:14px;margin-bottom:3px;}
    .event-item-time{color:#888;font-size:13px;}
    .no-events{text-align:center;color:#999;padding:40px 20px;font-style:italic;}
  </style>
</head>
<body>
  <div class="calendar-banner">Khaimook's Personal Calendar</div>

  <div class="main-container">
    <div class="project-header">
      <h1 class="project-title">Khaimook's Calendar</h1>
      <p class="project-subtitle">You can add your plan here :0</p>
      <p style="margin-top:10px;color:#666;">By Pattanan Siriworakul 670615030</p>
    </div>

    <div class="content-wrapper">
      <div class="calendar-body">
        <div class="calendar-header">
          <h1 class="calendar-title">My Calendar</h1>
          <div class="calendar-nav">
            <button class="nav-btn" id="prevBtn">‚Üê Back</button>
            <span class="current-month" id="currentMonth"></span>
            <button class="nav-btn" id="nextBtn">Next ‚Üí</button>
          </div>
        </div>
        <div class="stats"><h4>This Month's Stats</h4><span id="eventCount">Number of Events: 0</span></div>
        <div class="calendar-grid" id="calendarGrid"></div>
      </div>
      <div class="events-sidebar">
        <h3>üìÖ Events This Month</h3>
        <div id="eventsList"></div>
      </div>
    </div>
  </div>

  <button class="add-event-btn" id="addBtn">+</button>

  <div class="modal" id="eventModal">
    <div class="modal-content">
      <h3 id="modalTitle">New Event</h3>
      <input type="text" id="eventTitle" placeholder="Event title">
      <input type="date" id="eventDate">
      <input type="time" id="eventTime">
      <textarea id="eventDescription" placeholder="Description (optional)" rows="3"></textarea>
      <div class="modal-buttons">
        <button class="btn btn-primary" id="saveBtn">Save</button>
        <button class="btn btn-secondary" id="cancelBtn">Cancel</button>
        <button class="btn btn-danger" id="deleteBtn" style="display:none;">Delete</button>
      </div>
    </div>
  </div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import {
  getFirestore, collection, addDoc, onSnapshot, orderBy, query,
  doc, updateDoc, deleteDoc, serverTimestamp, enableIndexedDbPersistence
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBhXAxeQSG82C3815AdbsI6jZZqV6ohIw0",
  authDomain: "calendar030-b2037.firebaseapp.com",
  projectId: "calendar030-b2037",
  storageBucket: "calendar030-b2037.firebasestorage.app",
  messagingSenderId: "1025342358133",
  appId: "1:1025342358133:web:e7300b3fbbdde76c0c2e3c",
  measurementId: "G-5CGW8224Z8"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
try { await enableIndexedDbPersistence(db); } catch(e){}

const eventsRef = collection(db, "events");

let events = [], currentDate = new Date(), editingId = null;

function fmt(d){const y=d.getFullYear(),m=String(d.getMonth()+1).padStart(2,'0'),dd=String(d.getDate()).padStart(2,'0');return `${y}-${m}-${dd}`;}
function parse(s){const [y,m,d]=s.split('-').map(Number);return new Date(y,m-1,d);}
function same(a,b){return a.getFullYear()==b.getFullYear()&&a.getMonth()==b.getMonth()&&a.getDate()==b.getDate();}

onSnapshot(query(eventsRef, orderBy("date","asc")), snap=>{
  events = snap.docs.map(d=>({id:d.id,...d.data()}));
  renderCalendar();
});

function renderCalendar(){
  const grid=document.getElementById('calendarGrid'), monthLbl=document.getElementById('currentMonth');
  grid.innerHTML='';
  const months=['January','February','March','April','May','June','July','August','September','October','November','December'];
  const days=['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
  monthLbl.textContent=`${months[currentDate.getMonth()]} ${currentDate.getFullYear()}`;
  days.forEach(d=>{const h=document.createElement('div');h.className='day-header';h.textContent=d;grid.appendChild(h);});
  const first=new Date(currentDate.getFullYear(),currentDate.getMonth(),1);
  const start=new Date(first);start.setDate(first.getDate()-first.getDay());
  const today=new Date();
  for(let i=0;i<42;i++){
    const cd=new Date(start);cd.setDate(start.getDate()+i);
    const cell=document.createElement('div');cell.className='day-cell';
    if(cd.getMonth()!==currentDate.getMonth())cell.classList.add('other-month');
    if(same(cd,today))cell.classList.add('today');
    const num=document.createElement('div');num.className='day-number';num.textContent=cd.getDate();cell.appendChild(num);
    const ds=fmt(cd);const evts=events.filter(e=>e.date===ds);
    evts.forEach(ev=>{
      const tag=document.createElement('div');tag.className='event';tag.textContent=ev.title;
      tag.onclick=e=>{e.stopPropagation();openModal(ev);}
      cell.appendChild(tag);
    });
    cell.onclick=()=>openModal({date:ds});
    grid.appendChild(cell);
  }
  updateSidebar();
}

function updateSidebar(){
  const list=document.getElementById('eventsList');
  const count=document.getElementById('eventCount');
  const m=currentDate.getMonth(),y=currentDate.getFullYear();
  const monthEv=events.filter(e=>{const d=parse(e.date);return d.getMonth()==m&&d.getFullYear()==y;});
  count.textContent=`Number of Events: ${monthEv.length}`;
  list.innerHTML='';
  if(monthEv.length===0){list.innerHTML='<div class="no-events">No events this month</div>';return;}
  monthEv.sort((a,b)=>parse(a.date)-parse(b.date)).forEach(ev=>{
const div=document.createElement('div');div.className='event-item';
const dateStr=parse(ev.date).toLocaleDateString('en-US',{day:'numeric',month:'short',year:'numeric'});
div.innerHTML=`
      <div class="event-item-title">${ev.title}</div>
      <div class="event-item-date">üìÜ ${dateStr}</div>
      <div class="event-item-time">‚è∞ ${ev.time||'-'}</div>`;
div.onclick=()=>openModal(ev);
list.appendChild(div);
  });
}

async function saveEvent(){
  const title=document.getElementById('eventTitle').value.trim();
  const date=document.getElementById('eventDate').value;
  const time=document.getElementById('eventTime').value;
  const description=document.getElementById('eventDescription').value;
  if(!title||!date){alert('Please enter title and date');return;}
  if(editingId){
    await updateDoc(doc(db,'events',editingId),{title,date,time,description,updatedAt:serverTimestamp()});
  }else{
    await addDoc(eventsRef,{title,date,time,description,createdAt:serverTimestamp()});
  }
  closeModal();
}
async function deleteEvent(){
  if(!editingId)return;
  if(confirm('Delete this event?')){
    await deleteDoc(doc(db,'events',editingId));
    closeModal();
  }
}
function openModal(ev){
  document.getElementById('eventModal').style.display='flex';
  document.getElementById('modalTitle').textContent=ev.id?'Edit Event':'New Event';
  document.getElementById('eventTitle').value=ev.title||'';
  document.getElementById('eventDate').value=ev.date||fmt(new Date());
  document.getElementById('eventTime').value=ev.time||'';
  document.getElementById('eventDescription').value=ev.description||'';
  document.getElementById('deleteBtn').style.display=ev.id?'inline-block':'none';
  editingId=ev.id||null;
}
function closeModal(){
  document.getElementById('eventModal').style.display='none';
  editingId=null;
}

document.getElementById('addBtn').onclick=()=>openModal({date:fmt(new Date())});
document.getElementById('saveBtn').onclick=saveEvent;
document.getElementById('cancelBtn').onclick=closeModal;
document.getElementById('deleteBtn').onclick=deleteEvent;
document.getElementById('prevBtn').onclick=()=>{currentDate.setMonth(currentDate.getMonth()-1);renderCalendar();}
document.getElementById('nextBtn').onclick=()=>{currentDate.setMonth(currentDate.getMonth()+1);renderCalendar();}
window.onclick=e=>{if(e.target.id==='eventModal')closeModal();}
renderCalendar();
</script>
</body>
</html>
